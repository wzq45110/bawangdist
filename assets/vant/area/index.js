"use strict";

var __assign = undefined && undefined.__assign || function () {
    __assign = Object.assign || function (t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) {
                if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
            }
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var component_1 = require('./../common/component.js');
var shared_1 = require('./../picker/shared.js');
component_1.VantComponent({
    classes: ['active-class', 'toolbar-class', 'column-class'],
    props: __assign(__assign({}, shared_1.pickerProps), { value: String, areaList: {
            type: Object,
            value: {}
        }, columnsNum: {
            type: null,
            value: 3
        } }),
    data: {
        columns: [{ values: [] }, { values: [] }, { values: [] }],
        displayColumns: [{ values: [] }, { values: [] }, { values: [] }]
    },
    watch: {
        value: function value(_value) {
            this.code = _value;
            this.setValues();
        },
        areaList: 'setValues',
        columnsNum: function columnsNum(value) {
            this.setData({
                displayColumns: this.data.columns.slice(0, +value)
            });
        }
    },
    mounted: function mounted() {
        var _this = this;
        setTimeout(function () {
            _this.setValues();
        }, 0);
    },
    methods: {
        getPicker: function getPicker() {
            if (this.picker == null) {
                this.picker = this.selectComponent('.van-area__picker');
            }
            return this.picker;
        },
        onCancel: function onCancel(event) {
            this.emit('cancel', event.detail);
        },
        onConfirm: function onConfirm(event) {
            this.emit('confirm', event.detail);
        },
        emit: function emit(type, detail) {
            detail.values = detail.value;
            delete detail.value;
            this.$emit(type, detail);
        },
        onChange: function onChange(event) {
            var _this = this;
            var _a = event.detail,
                index = _a.index,
                picker = _a.picker,
                value = _a.value;
            this.code = value[index].code;
            this.setValues().then(function () {
                _this.$emit('change', {
                    picker: picker,
                    values: picker.getValues(),
                    index: index
                });
            });
        },
        getConfig: function getConfig(type) {
            var areaList = this.data.areaList;
            return areaList && areaList[type + "_list"] || {};
        },
        getList: function getList(type, code) {
            var result = [];
            if (type !== 'province' && !code) {
                return result;
            }
            var list = this.getConfig(type);
            result = Object.keys(list).map(function (code) {
                return {
                    code: code,
                    name: list[code]
                };
            });
            if (code) {
                // oversea code
                if (code[0] === '9' && type === 'city') {
                    code = '9';
                }
                result = result.filter(function (item) {
                    return item.code.indexOf(code) === 0;
                });
            }
            return result;
        },
        getIndex: function getIndex(type, code) {
            var compareNum = type === 'province' ? 2 : type === 'city' ? 4 : 6;
            var list = this.getList(type, code.slice(0, compareNum - 2));
            // oversea code
            if (code[0] === '9' && type === 'province') {
                compareNum = 1;
            }
            code = code.slice(0, compareNum);
            for (var i = 0; i < list.length; i++) {
                if (list[i].code.slice(0, compareNum) === code) {
                    return i;
                }
            }
            return 0;
        },
        setValues: function setValues() {
            var _this = this;
            var county = this.getConfig('county');
            var code = this.code || Object.keys(county)[0] || '';
            var province = this.getList('province');
            var city = this.getList('city', code.slice(0, 2));
            var picker = this.getPicker();
            if (!picker) {
                return;
            }
            var stack = [];
            stack.push(picker.setColumnValues(0, province, false));
            stack.push(picker.setColumnValues(1, city, false));
            if (city.length && code.slice(2, 4) === '00') {
                code = city[0].code;
            }
            stack.push(picker.setColumnValues(2, this.getList('county', code.slice(0, 4)), false));
            return Promise.all(stack).catch(function () {}).then(function () {
                return picker.setIndexes([_this.getIndex('province', code), _this.getIndex('city', code), _this.getIndex('county', code)]);
            }).catch(function () {});
        },
        getValues: function getValues() {
            var picker = this.getPicker();
            return picker ? picker.getValues().filter(function (value) {
                return !!value;
            }) : [];
        },
        getDetail: function getDetail() {
            var values = this.getValues();
            var area = {
                code: '',
                country: '',
                province: '',
                city: '',
                county: ''
            };
            if (!values.length) {
                return area;
            }
            var names = values.map(function (item) {
                return item.name;
            });
            area.code = values[values.length - 1].code;
            if (area.code[0] === '9') {
                area.country = names[1] || '';
                area.province = names[2] || '';
            } else {
                area.province = names[0] || '';
                area.city = names[1] || '';
                area.county = names[2] || '';
            }
            return area;
        },
        reset: function reset(code) {
            this.code = code || '';
            return this.setValues();
        }
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIl9fYXNzaWduIiwiT2JqZWN0IiwiYXNzaWduIiwidCIsInMiLCJpIiwibiIsImFyZ3VtZW50cyIsImxlbmd0aCIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY29tcG9uZW50XzEiLCJyZXF1aXJlIiwic2hhcmVkXzEiLCJWYW50Q29tcG9uZW50IiwiY2xhc3NlcyIsInByb3BzIiwicGlja2VyUHJvcHMiLCJTdHJpbmciLCJhcmVhTGlzdCIsInR5cGUiLCJjb2x1bW5zTnVtIiwiZGF0YSIsImNvbHVtbnMiLCJ2YWx1ZXMiLCJkaXNwbGF5Q29sdW1ucyIsIndhdGNoIiwiY29kZSIsInNldFZhbHVlcyIsInNldERhdGEiLCJzbGljZSIsIm1vdW50ZWQiLCJfdGhpcyIsInNldFRpbWVvdXQiLCJtZXRob2RzIiwiZ2V0UGlja2VyIiwicGlja2VyIiwic2VsZWN0Q29tcG9uZW50Iiwib25DYW5jZWwiLCJldmVudCIsImVtaXQiLCJkZXRhaWwiLCJvbkNvbmZpcm0iLCIkZW1pdCIsIm9uQ2hhbmdlIiwiX2EiLCJpbmRleCIsInRoZW4iLCJnZXRWYWx1ZXMiLCJnZXRDb25maWciLCJnZXRMaXN0IiwicmVzdWx0IiwibGlzdCIsImtleXMiLCJtYXAiLCJuYW1lIiwiZmlsdGVyIiwiaXRlbSIsImluZGV4T2YiLCJnZXRJbmRleCIsImNvbXBhcmVOdW0iLCJjb3VudHkiLCJwcm92aW5jZSIsImNpdHkiLCJzdGFjayIsInB1c2giLCJzZXRDb2x1bW5WYWx1ZXMiLCJQcm9taXNlIiwiYWxsIiwiY2F0Y2giLCJzZXRJbmRleGVzIiwiZ2V0RGV0YWlsIiwiYXJlYSIsImNvdW50cnkiLCJuYW1lcyIsInJlc2V0Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxJQUFJQSxXQUFZLGFBQVEsVUFBS0EsUUFBZCxJQUEyQixZQUFZO0FBQ2xE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QnlCLElBQXRDO0FBQ0EsZ0JBQUk2QyxLQUFLN0MsSUFBTCxDQUFVLENBQVYsTUFBaUIsR0FBckIsRUFBMEI7QUFDdEI2QyxxQkFBS0MsT0FBTCxHQUFlQyxNQUFNLENBQU4sS0FBWSxFQUEzQjtBQUNBRixxQkFBS1YsUUFBTCxHQUFnQlksTUFBTSxDQUFOLEtBQVksRUFBNUI7QUFDSCxhQUhELE1BSUs7QUFDREYscUJBQUtWLFFBQUwsR0FBZ0JZLE1BQU0sQ0FBTixLQUFZLEVBQTVCO0FBQ0FGLHFCQUFLVCxJQUFMLEdBQVlXLE1BQU0sQ0FBTixLQUFZLEVBQXhCO0FBQ0FGLHFCQUFLWCxNQUFMLEdBQWNhLE1BQU0sQ0FBTixLQUFZLEVBQTFCO0FBQ0g7QUFDRCxtQkFBT0YsSUFBUDtBQUNILFNBNUhJO0FBNkhMRyxlQUFPLGVBQVVoRCxJQUFWLEVBQWdCO0FBQ25CLGlCQUFLQSxJQUFMLEdBQVlBLFFBQVEsRUFBcEI7QUFDQSxtQkFBTyxLQUFLQyxTQUFMLEVBQVA7QUFDSDtBQWhJSTtBQS9CYSxDQUExQiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIGNvbXBvbmVudF8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9jb21wb25lbnRcIik7XHJcbnZhciBzaGFyZWRfMSA9IHJlcXVpcmUoXCIuLi9waWNrZXIvc2hhcmVkXCIpO1xyXG5jb21wb25lbnRfMS5WYW50Q29tcG9uZW50KHtcclxuICAgIGNsYXNzZXM6IFsnYWN0aXZlLWNsYXNzJywgJ3Rvb2xiYXItY2xhc3MnLCAnY29sdW1uLWNsYXNzJ10sXHJcbiAgICBwcm9wczogX19hc3NpZ24oX19hc3NpZ24oe30sIHNoYXJlZF8xLnBpY2tlclByb3BzKSwgeyB2YWx1ZTogU3RyaW5nLCBhcmVhTGlzdDoge1xyXG4gICAgICAgICAgICB0eXBlOiBPYmplY3QsXHJcbiAgICAgICAgICAgIHZhbHVlOiB7fVxyXG4gICAgICAgIH0sIGNvbHVtbnNOdW06IHtcclxuICAgICAgICAgICAgdHlwZTogbnVsbCxcclxuICAgICAgICAgICAgdmFsdWU6IDNcclxuICAgICAgICB9IH0pLFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIGNvbHVtbnM6IFt7IHZhbHVlczogW10gfSwgeyB2YWx1ZXM6IFtdIH0sIHsgdmFsdWVzOiBbXSB9XSxcclxuICAgICAgICBkaXNwbGF5Q29sdW1uczogW3sgdmFsdWVzOiBbXSB9LCB7IHZhbHVlczogW10gfSwgeyB2YWx1ZXM6IFtdIH1dXHJcbiAgICB9LFxyXG4gICAgd2F0Y2g6IHtcclxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29kZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlcygpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXJlYUxpc3Q6ICdzZXRWYWx1ZXMnLFxyXG4gICAgICAgIGNvbHVtbnNOdW06IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbHVtbnM6IHRoaXMuZGF0YS5jb2x1bW5zLnNsaWNlKDAsICt2YWx1ZSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG1vdW50ZWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBfdGhpcy5zZXRWYWx1ZXMoKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZ2V0UGlja2VyOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBpY2tlciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBpY2tlciA9IHRoaXMuc2VsZWN0Q29tcG9uZW50KCcudmFuLWFyZWFfX3BpY2tlcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBpY2tlcjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdjYW5jZWwnLCBldmVudC5kZXRhaWwpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb25Db25maXJtOiBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25maXJtJywgZXZlbnQuZGV0YWlsKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVtaXQ6IGZ1bmN0aW9uICh0eXBlLCBkZXRhaWwpIHtcclxuICAgICAgICAgICAgZGV0YWlsLnZhbHVlcyA9IGRldGFpbC52YWx1ZTtcclxuICAgICAgICAgICAgZGVsZXRlIGRldGFpbC52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy4kZW1pdCh0eXBlLCBkZXRhaWwpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgX2EgPSBldmVudC5kZXRhaWwsIGluZGV4ID0gX2EuaW5kZXgsIHBpY2tlciA9IF9hLnBpY2tlciwgdmFsdWUgPSBfYS52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5jb2RlID0gdmFsdWVbaW5kZXhdLmNvZGU7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVzKCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy4kZW1pdCgnY2hhbmdlJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpY2tlcjogcGlja2VyLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogcGlja2VyLmdldFZhbHVlcygpLFxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0Q29uZmlnOiBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgYXJlYUxpc3QgPSB0aGlzLmRhdGEuYXJlYUxpc3Q7XHJcbiAgICAgICAgICAgIHJldHVybiAoYXJlYUxpc3QgJiYgYXJlYUxpc3RbdHlwZSArIFwiX2xpc3RcIl0pIHx8IHt9O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0TGlzdDogZnVuY3Rpb24gKHR5cGUsIGNvZGUpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodHlwZSAhPT0gJ3Byb3ZpbmNlJyAmJiAhY29kZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXMuZ2V0Q29uZmlnKHR5cGUpO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBPYmplY3Qua2V5cyhsaXN0KS5tYXAoZnVuY3Rpb24gKGNvZGUpIHsgcmV0dXJuICh7XHJcbiAgICAgICAgICAgICAgICBjb2RlOiBjb2RlLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogbGlzdFtjb2RlXVxyXG4gICAgICAgICAgICB9KTsgfSk7XHJcbiAgICAgICAgICAgIGlmIChjb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBvdmVyc2VhIGNvZGVcclxuICAgICAgICAgICAgICAgIGlmIChjb2RlWzBdID09PSAnOScgJiYgdHlwZSA9PT0gJ2NpdHknKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZSA9ICc5JztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0uY29kZS5pbmRleE9mKGNvZGUpID09PSAwOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0SW5kZXg6IGZ1bmN0aW9uICh0eXBlLCBjb2RlKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21wYXJlTnVtID0gdHlwZSA9PT0gJ3Byb3ZpbmNlJyA/IDIgOiB0eXBlID09PSAnY2l0eScgPyA0IDogNjtcclxuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzLmdldExpc3QodHlwZSwgY29kZS5zbGljZSgwLCBjb21wYXJlTnVtIC0gMikpO1xyXG4gICAgICAgICAgICAvLyBvdmVyc2VhIGNvZGVcclxuICAgICAgICAgICAgaWYgKGNvZGVbMF0gPT09ICc5JyAmJiB0eXBlID09PSAncHJvdmluY2UnKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wYXJlTnVtID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2RlID0gY29kZS5zbGljZSgwLCBjb21wYXJlTnVtKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdFtpXS5jb2RlLnNsaWNlKDAsIGNvbXBhcmVOdW0pID09PSBjb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRWYWx1ZXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIGNvdW50eSA9IHRoaXMuZ2V0Q29uZmlnKCdjb3VudHknKTtcclxuICAgICAgICAgICAgdmFyIGNvZGUgPSB0aGlzLmNvZGUgfHwgT2JqZWN0LmtleXMoY291bnR5KVswXSB8fCAnJztcclxuICAgICAgICAgICAgdmFyIHByb3ZpbmNlID0gdGhpcy5nZXRMaXN0KCdwcm92aW5jZScpO1xyXG4gICAgICAgICAgICB2YXIgY2l0eSA9IHRoaXMuZ2V0TGlzdCgnY2l0eScsIGNvZGUuc2xpY2UoMCwgMikpO1xyXG4gICAgICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5nZXRQaWNrZXIoKTtcclxuICAgICAgICAgICAgaWYgKCFwaWNrZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgc3RhY2sgPSBbXTtcclxuICAgICAgICAgICAgc3RhY2sucHVzaChwaWNrZXIuc2V0Q29sdW1uVmFsdWVzKDAsIHByb3ZpbmNlLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICBzdGFjay5wdXNoKHBpY2tlci5zZXRDb2x1bW5WYWx1ZXMoMSwgY2l0eSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgaWYgKGNpdHkubGVuZ3RoICYmIGNvZGUuc2xpY2UoMiwgNCkgPT09ICcwMCcpIHtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSBjaXR5WzBdLmNvZGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RhY2sucHVzaChwaWNrZXIuc2V0Q29sdW1uVmFsdWVzKDIsIHRoaXMuZ2V0TGlzdCgnY291bnR5JywgY29kZS5zbGljZSgwLCA0KSksIGZhbHNlKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChzdGFjaylcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7IH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGlja2VyLnNldEluZGV4ZXMoW1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmdldEluZGV4KCdwcm92aW5jZScsIGNvZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmdldEluZGV4KCdjaXR5JywgY29kZSksXHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZ2V0SW5kZXgoJ2NvdW50eScsIGNvZGUpXHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7IH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0VmFsdWVzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBwaWNrZXIgPSB0aGlzLmdldFBpY2tlcigpO1xyXG4gICAgICAgICAgICByZXR1cm4gcGlja2VyID8gcGlja2VyLmdldFZhbHVlcygpLmZpbHRlcihmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuICEhdmFsdWU7IH0pIDogW107XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXREZXRhaWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuZ2V0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgIHZhciBhcmVhID0ge1xyXG4gICAgICAgICAgICAgICAgY29kZTogJycsXHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5OiAnJyxcclxuICAgICAgICAgICAgICAgIHByb3ZpbmNlOiAnJyxcclxuICAgICAgICAgICAgICAgIGNpdHk6ICcnLFxyXG4gICAgICAgICAgICAgICAgY291bnR5OiAnJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhcmVhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBuYW1lcyA9IHZhbHVlcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsgcmV0dXJuIGl0ZW0ubmFtZTsgfSk7XHJcbiAgICAgICAgICAgIGFyZWEuY29kZSA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV0uY29kZTtcclxuICAgICAgICAgICAgaWYgKGFyZWEuY29kZVswXSA9PT0gJzknKSB7XHJcbiAgICAgICAgICAgICAgICBhcmVhLmNvdW50cnkgPSBuYW1lc1sxXSB8fCAnJztcclxuICAgICAgICAgICAgICAgIGFyZWEucHJvdmluY2UgPSBuYW1lc1syXSB8fCAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFyZWEucHJvdmluY2UgPSBuYW1lc1swXSB8fCAnJztcclxuICAgICAgICAgICAgICAgIGFyZWEuY2l0eSA9IG5hbWVzWzFdIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgYXJlYS5jb3VudHkgPSBuYW1lc1syXSB8fCAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYXJlYTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoY29kZSkge1xyXG4gICAgICAgICAgICB0aGlzLmNvZGUgPSBjb2RlIHx8ICcnO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRWYWx1ZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=